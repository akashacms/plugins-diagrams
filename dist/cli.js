#! /usr/bin/env node
const __dirname = import.meta.dirname;
import { promises as fsp } from 'node:fs';
import util from 'node:util';
// import packageConfig from '../package.json' with { type: 'json' }; 
import { doPlantUMLLocal, isValidCharset, doPintora } from './index.js';
import { Command } from 'commander';
const program = new Command();
// PROG plantuml --input .. --output .. --other-options ..
// PROG mermaid
// PROG katex
// program.name(packageConfig.name);
// program
//     .version(packageConfig.version,
//         '-v, --version', 'output the current version')
program
    .command('plantuml')
    .description('Render PlantUML files')
    .option('--input-file <inputFN...>', 'Path for document to render')
    .option('--output-file <outputFN>', 'Path for rendered document')
    .option('--charset <charset>', 'To use a specific character set. Default: UTF-8')
    // TODO --checkmetadata Skip PNG files that don't need to be regenerated
    // TODO -Dvar=value should be --define <defVarValue...>
    .option('--darkmode', 'To use dark mode for diagrams')
    .option('--debugsvek', 'To generate intermediate svek files')
    // TODO --exclude pattern about excluding files from consideration
    //          based on a pattern
    // TODO --disablestats To disable statistics computation (default)
    // TODO --enablestats To enable statistics computation
    // TODO --encodesprite 4|8|16 "file"  To encode a sprite at a gray level from an image
    // TODO --failfast To stop processing as soon as a syntax error in diagram occurs
    // TODO --failfast2 To do a first syntax check before processing files, to fail even faster
    // TODO --filedir <dirNm> To behave as if PlantUML is in this dir
    .option('--filename <fileNm>', '"example.puml" To override %filename% variable')
    // TODO --graphvizdot "exe" To specify dot executable
    // TODO --htmlstats  To output general statistics in file plantuml-stats.html
    // TODO -I/path/to/file     To include file as if '!include file' were used
    // TODO -I/path/to/*.puml   To include files with pattern
    // TODO -language           To print the list of PlantUML keywords
    // TODO -loopstats          To continuously print statistics about usage
    // TODO -metadata           To retrieve PlantUML sources from PNG images
    .option('--nbthread <nThreads>', 'To use (N) threads for processing.  Use "auto" for 4 threads.')
    // TODO -noerror            To skip images when error in diagrams
    .option('--nometadata', 'To NOT export metadata in PNG/SVG generated files')
    .option('--output-dir <outDir>', 'To generate images in the specified directory')
    // .option('--overwrite', 'To allow to overwrite read only files')
    // TODO -Ppragma1=value     To set pragma as if '!pragma pragma1 value' were used
    // TODO -p[ipe]             To use stdin for PlantUML source and stdout for PNG/SVG/EPS generation
    // TODO -picoweb            To start internal HTTP Server. See https://plantuml.com/picoweb
    // TODO -pipeimageindex N   To generate the Nth image with pipe option
    // TODO -preproc            To output preprocessor text of diagrams
    // TODO -printfonts         To print fonts available on your system
    // TODO -progress           To display a textual progress bar in console
    // TODO -quiet              To NOT print error message into the console
    // TODO -realtimestats      To generate statistics on the fly rather than at the end
    // TODO -Sparam1=value      To set a skin parameter as if 'skinparam param1 value' were used
    // TODO -splash             To display a splash screen with some progress bar
    // TODO -stdlib             To print standard library info
    // TODO -syntax             To report any syntax error from standard input without generating images
    // TODO -testdot            To test the installation of graphviz
    // TODO -theme xxx          To use a specific theme
    // TODO -timeout N          Processing timeout in (N) seconds. Defaults to 15 minutes (900 seconds).
    .option('--teps', 'To generate images using EPS format')
    .option('--thtml', 'To generate HTML file for class diagram')
    // TODO -tlatex:nopreamble  To generate images using LaTeX/Tikz format without preamble
    .option('--tlatex', 'To generate images using LaTeX/Tikz format')
    .option('--tpdf', 'To generate images using PDF format')
    .option('--tpng', 'To generate images using PNG format (default)')
    .option('--tscxml', 'To generate SCXML file for state diagram')
    .option('--tsvg', 'To generate images using SVG format')
    .option('--ttxt', 'To generate images with ASCII art')
    .option('--tutxt', 'To generate images with ASCII art using Unicode characters')
    .option('--tvdx', 'To generate images using VDX format')
    .option('--txmi', 'To generate XMI file for class diagram')
    .option('--verbose', 'To have log information')
    // TODO -xmlstats           To output general statistics in file plantuml-stats.xml
    .action(async (cmdObj) => {
    const options = {
        // inputBody does not make sense for CLI
        // inputBody: typeof inputFN === 'string'
        //         ? await fsp.readFile(inputFN, 'utf-8')
        //         : undefined,
        inputFNs: cmdObj.inputFile,
        outputFN: cmdObj.outputFile
    };
    if (cmdObj.charset) {
        if (!isValidCharset(cmdObj.charset)) {
            throw new Error(`plantuml charset ${util.inspect(cmdObj.charset)} unknown`);
        }
        options.charset = cmdObj.charset;
    }
    if (cmdObj.nbthread) {
        if (cmdObj.nbthread !== 'auto') {
            const nt = Number.parseInt(cmdObj.nbthread);
            if (isNaN(nt) || nt < 0 || nt > 16) {
                throw new Error(`plantuml nbthread ${util.inspect(cmdObj.nbthread)} invalid`);
            }
        }
        options.nbthread = cmdObj.nbthread;
    }
    if ('darkmode' in cmdObj) {
        if (typeof cmdObj.darkmode !== 'boolean') {
            throw new Error(`plantuml invalid darkmode option ${util.inspect(cmdObj.darkmode)}`);
        }
        options.darkmode = cmdObj.darkmode;
    }
    if ('debugsvek' in cmdObj) {
        if (typeof cmdObj.debugsvek !== 'boolean') {
            throw new Error(`plantuml invalid debugsvek option ${util.inspect(cmdObj.debugsvek)}`);
        }
        options.debugsvek = cmdObj.debugsvek;
    }
    if ('filename' in cmdObj) {
        if (typeof cmdObj.filename !== 'boolean') {
            throw new Error(`plantuml invalid filename option ${util.inspect(cmdObj.filename)}`);
        }
        options.fileNameOverride = cmdObj.filename;
    }
    if ('nometadata' in cmdObj) {
        if (typeof cmdObj.nometadata !== 'boolean') {
            throw new Error(`plantuml invalid nometadata option ${util.inspect(cmdObj.nometadata)}`);
        }
        options.nometadata = cmdObj.nometadata;
    }
    options.outputDir = cmdObj.outputDir;
    if ('teps' in cmdObj) {
        if (typeof cmdObj.teps !== 'boolean') {
            throw new Error(`plantuml invalid teps option ${util.inspect(cmdObj.teps)}`);
        }
        options.teps = cmdObj.teps;
    }
    if ('thtml' in cmdObj) {
        if (typeof cmdObj.thtml !== 'boolean') {
            throw new Error(`plantuml invalid thtml option ${util.inspect(cmdObj.thtml)}`);
        }
        options.thtml = cmdObj.thtml;
    }
    if ('tlatex' in cmdObj) {
        if (typeof cmdObj.tlatex !== 'boolean') {
            throw new Error(`plantuml invalid tlatex option ${util.inspect(cmdObj.tlatex)}`);
        }
        options.tlatex = cmdObj.tlatex;
    }
    if ('tpdf' in cmdObj) {
        if (typeof cmdObj.tpdf !== 'boolean') {
            throw new Error(`plantuml invalid tpdf option ${util.inspect(cmdObj.tpdf)}`);
        }
        options.tpdf = cmdObj.tpdf;
    }
    if ('tpng' in cmdObj) {
        if (typeof cmdObj.tpng !== 'boolean') {
            throw new Error(`plantuml invalid tpng option ${util.inspect(cmdObj.tpng)}`);
        }
        options.tpng = cmdObj.tpng;
    }
    if ('tscxml' in cmdObj) {
        if (typeof cmdObj.tscxml !== 'boolean') {
            throw new Error(`plantuml invalid tscxml option ${util.inspect(cmdObj.tscxml)}`);
        }
        options.tscxml = cmdObj.tscxml;
    }
    if ('tsvg' in cmdObj) {
        if (typeof cmdObj.tsvg !== 'boolean') {
            throw new Error(`plantuml invalid tsvg option ${util.inspect(cmdObj.tsvg)}`);
        }
        options.tsvg = cmdObj.tsvg;
    }
    if ('ttxt' in cmdObj) {
        if (typeof cmdObj.tsvg !== 'boolean') {
            throw new Error(`plantuml invalid ttxt option ${util.inspect(cmdObj.ttxt)}`);
        }
        options.ttxt = cmdObj.ttxt;
    }
    if ('tutxt' in cmdObj) {
        if (typeof cmdObj.tutxt !== 'boolean') {
            throw new Error(`plantuml invalid tutxt option ${util.inspect(cmdObj.tutxt)}`);
        }
        options.tutxt = cmdObj.tutxt;
    }
    if ('tvdx' in cmdObj) {
        if (typeof cmdObj.tvdx !== 'boolean') {
            throw new Error(`plantuml invalid tvdx option ${util.inspect(cmdObj.tvdx)}`);
        }
        options.tvdx = cmdObj.tvdx;
    }
    if ('txmi' in cmdObj) {
        if (typeof cmdObj.txmi !== 'boolean') {
            throw new Error(`plantuml invalid txmi option ${util.inspect(cmdObj.txmi)}`);
        }
        options.txmi = cmdObj.txmi;
    }
    if ('verbose' in cmdObj) {
        if (typeof cmdObj.verbose !== 'boolean') {
            throw new Error(`plantuml invalid verbose option ${util.inspect(cmdObj.verbose)}`);
        }
        options.verbose = cmdObj.verbose;
    }
    console.log({
        cmdObj, options
    });
    await doPlantUMLLocal(options);
});
program
    .command('pintora')
    .description('Render Pintora files')
    .option('--input-file <inputFN>', 'Path for document to render')
    .option('--output-file <outputFN>', 'Path for rendered document')
    .option('--pixel-ratio <ratio>', '')
    .option('--mime-type <mt>', 'MIME type for output file')
    .option('--bg-color <color>', 'String describing background color')
    .option('--width <number>', 'Width of the output, height will be calculated according to the diagram content ratio')
    .action(async (cmdObj) => {
    const opts = {
        code: '',
        outputFN: ''
    };
    if (typeof cmdObj.inputFile === 'string') {
        opts.code = await fsp.readFile(cmdObj.inputFile, 'utf-8');
    }
    else {
        throw new Error('No input file specified');
    }
    if (typeof cmdObj.outputFile === 'string') {
        opts.outputFN = cmdObj.outputFile;
    }
    else {
        throw new Error('No output file specified');
    }
    if (typeof cmdObj.pixelRatio === 'string') {
        opts.devicePixelRatio = Number.parseFloat(cmdObj.pixelRatio);
    }
    if (typeof opts.devicePixelRatio !== 'undefined'
        && isNaN(opts.devicePixelRatio)) {
        throw new Error(`Invalid device pixel ratio ${util.inspect(cmdObj.pixelRatio)}`);
    }
    if (typeof cmdObj.mimeType === 'string') {
        if (cmdObj.mimeType === 'image/svg+xml'
            || cmdObj.mimeType === 'image/jpeg'
            || cmdObj.mimeType === 'image/png') {
            opts.mimeType = cmdObj.mimeType;
        }
        else {
            throw new Error(`Invalid MIME type ${util.inspect(cmdObj.mimeType)}`);
        }
    }
    if (typeof cmdObj.bgColor === 'string') {
        opts.backgroundColor = cmdObj.bgColor;
    }
    if (typeof cmdObj.width === 'string') {
        opts.width = Number.parseFloat(cmdObj.width);
        if (isNaN(opts.width)) {
            throw new Error(`diagrams-pintora: width is not a number ${cmdObj.width}`);
        }
    }
    opts.renderInSubprocess = false;
    await doPintora(opts);
});
program.parse();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vbGliL2NsaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBRUEsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7QUFFdEMsT0FBTyxFQUFFLFFBQVEsSUFBSSxHQUFHLEVBQWEsTUFBTSxTQUFTLENBQUM7QUFFckQsT0FBTyxJQUFJLE1BQU0sV0FBVyxDQUFDO0FBRTdCLHNFQUFzRTtBQUV0RSxPQUFPLEVBQXFCLGVBQWUsRUFBRSxjQUFjLEVBQXdCLFNBQVMsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUVqSCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3BDLE1BQU0sT0FBTyxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7QUFFOUIsMERBQTBEO0FBQzFELGVBQWU7QUFDZixhQUFhO0FBRWIsb0NBQW9DO0FBQ3BDLFVBQVU7QUFDVixzQ0FBc0M7QUFDdEMseURBQXlEO0FBRXpELE9BQU87S0FDRixPQUFPLENBQUMsVUFBVSxDQUFDO0tBQ25CLFdBQVcsQ0FBQyx1QkFBdUIsQ0FBQztLQUNwQyxNQUFNLENBQUMsMkJBQTJCLEVBQUUsNkJBQTZCLENBQUM7S0FDbEUsTUFBTSxDQUFDLDBCQUEwQixFQUFFLDRCQUE0QixDQUFDO0tBQ2hFLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxpREFBaUQsQ0FBQztJQUNqRix3RUFBd0U7SUFDeEUsdURBQXVEO0tBQ3RELE1BQU0sQ0FBQyxZQUFZLEVBQUUsK0JBQStCLENBQUM7S0FDckQsTUFBTSxDQUFDLGFBQWEsRUFBRSxxQ0FBcUMsQ0FBQztJQUM3RCxrRUFBa0U7SUFDbEUsOEJBQThCO0lBQzlCLGtFQUFrRTtJQUNsRSxzREFBc0Q7SUFDdEQsc0ZBQXNGO0lBQ3RGLGlGQUFpRjtJQUNqRiwyRkFBMkY7SUFDM0YsaUVBQWlFO0tBQ2hFLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxnREFBZ0QsQ0FBQztJ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QUM7UUFDMUUsQ0FBQztJQUNMLENBQUM7SUFFRCxJQUFJLE9BQU8sTUFBTSxDQUFDLE9BQU8sS0FBSyxRQUFRLEVBQUUsQ0FBQztRQUNyQyxJQUFJLENBQUMsZUFBZSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUM7SUFDMUMsQ0FBQztJQUVELElBQUksT0FBTyxNQUFNLENBQUMsS0FBSyxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQ25DLElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0MsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDcEIsTUFBTSxJQUFJLEtBQUssQ0FBQywyQ0FBMkMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDL0UsQ0FBQztJQUNMLENBQUM7SUFFRCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsS0FBSyxDQUFDO0lBRWhDLE1BQU0sU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzFCLENBQUMsQ0FBQyxDQUFDO0FBR1AsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiIyEgL3Vzci9iaW4vZW52IG5vZGVcblxuY29uc3QgX19kaXJuYW1lID0gaW1wb3J0Lm1ldGEuZGlybmFtZTtcblxuaW1wb3J0IHsgcHJvbWlzZXMgYXMgZnNwLCBjb25zdGFudHMgfSBmcm9tICdub2RlOmZzJztcbmltcG9ydCBwYXRoLCB7IHBhcnNlIH0gZnJvbSAnbm9kZTpwYXRoJztcbmltcG9ydCB1dGlsIGZyb20gJ25vZGU6dXRpbCc7XG5cbi8vIGltcG9ydCBwYWNrYWdlQ29uZmlnIGZyb20gJy4uL3BhY2thZ2UuanNvbicgd2l0aCB7IHR5cGU6ICdqc29uJyB9OyBcblxuaW1wb3J0IHsgZG9QbGFudFVNTE9wdGlvbnMsIGRvUGxhbnRVTUxMb2NhbCwgaXNWYWxpZENoYXJzZXQsIFBpbnRvcmFSZW5kZXJPcHRpb25zLCBkb1BpbnRvcmEgfSBmcm9tICcuL2luZGV4LmpzJztcblxuaW1wb3J0IHsgQ29tbWFuZCB9IGZyb20gJ2NvbW1hbmRlcic7XG5jb25zdCBwcm9ncmFtID0gbmV3IENvbW1hbmQoKTtcblxuLy8gUFJPRyBwbGFudHVtbCAtLWlucHV0IC4uIC0tb3V0cHV0IC4uIC0tb3RoZXItb3B0aW9ucyAuLlxuLy8gUFJPRyBtZXJtYWlkXG4vLyBQUk9HIGthdGV4XG5cbi8vIHByb2dyYW0ubmFtZShwYWNrYWdlQ29uZmlnLm5hbWUpO1xuLy8gcHJvZ3JhbVxuLy8gICAgIC52ZXJzaW9uKHBhY2thZ2VDb25maWcudmVyc2lvbixcbi8vICAgICAgICAgJy12LCAtLXZlcnNpb24nLCAnb3V0cHV0IHRoZSBjdXJyZW50IHZlcnNpb24nKVxuXG5wcm9ncmFtXG4gICAgLmNvbW1hbmQoJ3BsYW50dW1sJylcbiAgICAuZGVzY3JpcHRpb24oJ1JlbmRlciBQbGFudFVNTCBmaWxlcycpXG4gICAgLm9wdGlvbignLS1pbnB1dC1maWxlIDxpbnB1dEZOLi4uPicsICdQYXRoIGZvciBkb2N1bWVudCB0byByZW5kZXInKVxuICAgIC5vcHRpb24oJy0tb3V0cHV0LWZpbGUgPG91dHB1dEZOPicsICdQYXRoIGZvciByZW5kZXJlZCBkb2N1bWVudCcpXG4gICAgLm9wdGlvbignLS1jaGFyc2V0IDxjaGFyc2V0PicsICdUbyB1c2UgYSBzcGVjaWZpYyBjaGFyYWN0ZXIgc2V0LiBEZWZhdWx0OiBVVEYtOCcpXG4gICAgLy8gVE9ETyAtLWNoZWNrbWV0YWRhdGEgU2tpcCBQTkcgZmlsZXMgdGhhdCBkb24ndCBuZWVkIHRvIGJlIHJlZ2VuZXJhdGVkXG4gICAgLy8gVE9ETyAtRHZhcj12YWx1ZSBzaG91bGQgYmUgLS1kZWZpbmUgPGRlZlZhclZhbHVlLi4uPlxuICAgIC5vcHRpb24oJy0tZGFya21vZGUnLCAnVG8gdXNlIGRhcmsgbW9kZSBmb3IgZGlhZ3JhbXMnKVxuICAgIC5vcHRpb24oJy0tZGVidWdzdmVrJywgJ1RvIGdlbmVyYXRlIGludGVybWVkaWF0ZSBzdmVrIGZpbGVzJylcbiAgICAvLyBUT0RPIC0tZXhjbHVkZSBwYXR0ZXJuIGFib3V0IGV4Y2x1ZGluZyBmaWxlcyBmcm9tIGNvbnNpZGVyYXRpb25cbiAgICAvLyAgICAgICAgICBiYXNlZCBvbiBhIHBhdHRlcm5cbiAgICAvLyBUT0RPIC0tZGlzYWJsZXN0YXRzIFRvIGRpc2FibGUgc3RhdGlzdGljcyBjb21wdXRhdGlvbiAoZGVmYXVsdClcbiAgICAvLyBUT0RPIC0tZW5hYmxlc3RhdHMgVG8gZW5hYmxlIHN0YXRpc3RpY3MgY29tcHV0YXRpb25cbiAgICAvLyBUT0RPIC0tZW5jb2Rlc3ByaXRlIDR8OHwxNiBcImZpbGVcIiAgVG8gZW5jb2RlIGEgc3ByaXRlIGF0IGEgZ3JheSBsZXZlbCBmcm9tIGFuIGltYWdlXG4gICAgLy8gVE9ETyAtLWZhaWxmYXN0IFRvIHN0b3AgcHJvY2Vzc2luZyBhcyBzb29uIGFzIGEgc3ludGF4IGVycm9yIGluIGRpYWdyYW0gb2NjdXJzXG4gICAgLy8gVE9ETyAtLWZhaWxmYXN0MiBUbyBkbyBhIGZpcnN0IHN5bnRheCBjaGVjayBiZWZvcmUgcHJvY2Vzc2luZyBmaWxlcywgdG8gZmFpbCBldmVuIGZhc3RlclxuICAgIC8vIFRPRE8gLS1maWxlZGlyIDxkaXJObT4gVG8gYmVoYXZlIGFzIGlmIFBsYW50VU1MIGlzIGluIHRoaXMgZGlyXG4gICAgLm9wdGlvbignLS1maWxlbmFtZSA8ZmlsZU5tPicsICdcImV4YW1wbGUucHVtbFwiIFRvIG92ZXJyaWRlICVmaWxlbmFtZSUgdmFyaWFibGUnKVxuICAgIC8vIFRPRE8gLS1ncmFwaHZpemRvdCBcImV4ZVwiIFRvIHNwZWNpZnkgZG90IGV4ZWN1dGFibGVcbiAgICAvLyBUT0RPIC0taHRtbHN0YXRzICBUbyBvdXRwdXQgZ2VuZXJhbCBzdGF0aXN0aWNzIGluIGZpbGUgcGxhbnR1bWwtc3RhdHMuaHRtbFxuICAgIC8vIFRPRE8gLUkvcGF0aC90by9maWxlICAgICBUbyBpbmNsdWRlIGZpbGUgYXMgaWYgJyFpbmNsdWRlIGZpbGUnIHdlcmUgdXNlZFxuICAgIC8vIFRPRE8gLUkvcGF0aC90by8qLnB1bWwgICBUbyBpbmNsdWRlIGZpbGVzIHdpdGggcGF0dGVyblxuICAgIC8vIFRPRE8gLWxhbmd1YWdlICAgICAgICAgICBUbyBwcmludCB0aGUgbGlzdCBvZiBQbGFudFVNTCBrZXl3b3Jkc1xuICAgIC8vIFRPRE8gLWxvb3BzdGF0cyAgICAgICAgICBUbyBjb250aW51b3VzbHkgcHJpbnQgc3RhdGlzdGljcyBhYm91dCB1c2FnZVxuICAgIC8vIFRPRE8gLW1ldGFkYXRhICAgICAgICAgICBUbyByZXRyaWV2ZSBQbGFudFVNTCBzb3VyY2VzIGZyb20gUE5HIGltYWdlc1xuICAgIC5vcHRpb24oJy0tbmJ0aHJlYWQgPG5UaHJlYWRzPicsICdUbyB1c2UgKE4pIHRocmVhZHMgZm9yIHByb2Nlc3NpbmcuICBVc2UgXCJhdXRvXCIgZm9yIDQgdGhyZWFkcy4nKVxuICAgIC8vIFRPRE8gLW5vZXJyb3IgICAgICAgICAgICBUbyBza2lwIGltYWdlcyB3aGVuIGVycm9yIGluIGRpYWdyYW1zXG4gICAgLm9wdGlvbignLS1ub21ldGFkYXRhJywgJ1RvIE5PVCBleHBvcnQgbWV0YWRhdGEgaW4gUE5HL1NWRyBnZW5lcmF0ZWQgZmlsZXMnKVxuICAgIC5vcHRpb24oJy0tb3V0cHV0LWRpciA8b3V0RGlyPicsICdUbyBnZW5lcmF0ZSBpbWFnZXMgaW4gdGhlIHNwZWNpZmllZCBkaXJlY3RvcnknKVxuICAgIC8vIC5vcHRpb24oJy0tb3ZlcndyaXRlJywgJ1RvIGFsbG93IHRvIG92ZXJ3cml0ZSByZWFkIG9ubHkgZmlsZXMnKVxuICAgIC8vIFRPRE8gLVBwcmFnbWExPXZhbHVlICAgICBUbyBzZXQgcHJhZ21hIGFzIGlmICchcHJhZ21hIHByYWdtYTEgdmFsdWUnIHdlcmUgdXNlZFxuICAgIC8vIFRPRE8gLXBbaXBlXSAgICAgICAgICAgICBUbyB1c2Ugc3RkaW4gZm9yIFBsYW50VU1MIHNvdXJjZSBhbmQgc3Rkb3V0IGZvciBQTkcvU1ZHL0VQUyBnZW5lcmF0aW9uXG4gICAgLy8gVE9ETyAtcGljb3dlYiAgICAgICAgICAgIFRvIHN0YXJ0IGludGVybmFsIEhUVFAgU2VydmVyLiBTZWUgaHR0cHM6Ly9wbGFudHVtbC5jb20vcGljb3dlYlxuICAgIC8vIFRPRE8gLXBpcGVpbWFnZWluZGV4IE4gICBUbyBnZW5lcmF0ZSB0aGUgTnRoIGltYWdlIHdpdGggcGlwZSBvcHRpb25cbiAgICAvLyBUT0RPIC1wcmVwcm9jICAgICAgICAgICAgVG8gb3V0cHV0IHByZXByb2Nlc3NvciB0ZXh0IG9mIGRpYWdyYW1zXG4gICAgLy8gVE9ETyAtcHJpbnRmb250cyAgICAgICAgIFRvIHByaW50IGZvbnRzIGF2YWlsYWJsZSBvbiB5b3VyIHN5c3RlbVxuICAgIC8vIFRPRE8gLXByb2dyZXNzICAgICAgICAgICBUbyBkaXNwbGF5IGEgdGV4dHVhbCBwcm9ncmVzcyBiYXIgaW4gY29uc29sZVxuICAgIC8vIFRPRE8gLXF1aWV0ICAgICAgICAgICAgICBUbyBOT1QgcHJpbnQgZXJyb3IgbWVzc2FnZSBpbnRvIHRoZSBjb25zb2xlXG4gICAgLy8gVE9ETyAtcmVhbHRpbWVzdGF0cyAgICAgIFRvIGdlbmVyYXRlIHN0YXRpc3RpY3Mgb24gdGhlIGZseSByYXRoZXIgdGhhbiBhdCB0aGUgZW5kXG4gICAgLy8gVE9ETyAtU3BhcmFtMT12YWx1ZSAgICAgIFRvIHNldCBhIHNraW4gcGFyYW1ldGVyIGFzIGlmICdza2lucGFyYW0gcGFyYW0xIHZhbHVlJyB3ZXJlIHVzZWRcbiAgICAvLyBUT0RPIC1zcGxhc2ggICAgICAgICAgICAgVG8gZGlzcGxheSBhIHNwbGFzaCBzY3JlZW4gd2l0aCBzb21lIHByb2dyZXNzIGJhclxuICAgIC8vIFRPRE8gLXN0ZGxpYiAgICAgICAgICAgICBUbyBwcmludCBzdGFuZGFyZCBsaWJyYXJ5IGluZm9cbiAgICAvLyBUT0RPIC1zeW50YXggICAgICAgICAgICAgVG8gcmVwb3J0IGFueSBzeW50YXggZXJyb3IgZnJvbSBzdGFuZGFyZCBpbnB1dCB3aXRob3V0IGdlbmVyYXRpbmcgaW1hZ2VzXG4gICAgLy8gVE9ETyAtdGVzdGRvdCAgICAgICAgICAgIFRvIHRlc3QgdGhlIGluc3RhbGxhdGlvbiBvZiBncmFwaHZpelxuICAgIC8vIFRPRE8gLXRoZW1lIHh4eCAgICAgICAgICBUbyB1c2UgYSBzcGVjaWZpYyB0aGVtZVxuICAgIC8vIFRPRE8gLXRpbWVvdXQgTiAgICAgICAgICBQcm9jZXNzaW5nIHRpbWVvdXQgaW4gKE4pIHNlY29uZHMuIERlZmF1bHRzIHRvIDE1IG1pbnV0ZXMgKDkwMCBzZWNvbmRzKS5cbiAgICAub3B0aW9uKCctLXRlcHMnLCAnVG8gZ2VuZXJhdGUgaW1hZ2VzIHVzaW5nIEVQUyBmb3JtYXQnKVxuICAgIC5vcHRpb24oJy0tdGh0bWwnLCAnVG8gZ2VuZXJhdGUgSFRNTCBmaWxlIGZvciBjbGFzcyBkaWFncmFtJylcbiAgICAvLyBUT0RPIC10bGF0ZXg6bm9wcmVhbWJsZSAgVG8gZ2VuZXJhdGUgaW1hZ2VzIHVzaW5nIExhVGVYL1Rpa3ogZm9ybWF0IHdpdGhvdXQgcHJlYW1ibGVcbiAgICAub3B0aW9uKCctLXRsYXRleCcsICdUbyBnZW5lcmF0ZSBpbWFnZXMgdXNpbmcgTGFUZVgvVGlreiBmb3JtYXQnKVxuICAgIC5vcHRpb24oJy0tdHBkZicsICdUbyBnZW5lcmF0ZSBpbWFnZXMgdXNpbmcgUERGIGZvcm1hdCcpXG4gICAgLm9wdGlvbignLS10cG5nJywgJ1RvIGdlbmVyYXRlIGltYWdlcyB1c2luZyBQTkcgZm9ybWF0IChkZWZhdWx0KScpXG4gICAgLm9wdGlvbignLS10c2N4bWwnLCAnVG8gZ2VuZXJhdGUgU0NYTUwgZmlsZSBmb3Igc3RhdGUgZGlhZ3JhbScpXG4gICAgLm9wdGlvbignLS10c3ZnJywgJ1RvIGdlbmVyYXRlIGltYWdlcyB1c2luZyBTVkcgZm9ybWF0JylcbiAgICAub3B0aW9uKCctLXR0eHQnLCAnVG8gZ2VuZXJhdGUgaW1hZ2VzIHdpdGggQVNDSUkgYXJ0JylcbiAgICAub3B0aW9uKCctLXR1dHh0JywgJ1RvIGdlbmVyYXRlIGltYWdlcyB3aXRoIEFTQ0lJIGFydCB1c2luZyBVbmljb2RlIGNoYXJhY3RlcnMnKVxuICAgIC5vcHRpb24oJy0tdHZkeCcsICdUbyBnZW5lcmF0ZSBpbWFnZXMgdXNpbmcgVkRYIGZvcm1hdCcpXG4gICAgLm9wdGlvbignLS10eG1pJywgJ1RvIGdlbmVyYXRlIFhNSSBmaWxlIGZvciBjbGFzcyBkaWFncmFtJylcbiAgICAub3B0aW9uKCctLXZlcmJvc2UnLCAnVG8gaGF2ZSBsb2cgaW5mb3JtYXRpb24nKVxuICAgIC8vIFRPRE8gLXhtbHN0YXRzICAgICAgICAgICBUbyBvdXRwdXQgZ2VuZXJhbCBzdGF0aXN0aWNzIGluIGZpbGUgcGxhbnR1bWwtc3RhdHMueG1sXG4gICAgLmFjdGlvbihhc3luYyAoY21kT2JqKSA9PiB7XG5cbiAgICAgICAgY29uc3Qgb3B0aW9uczogZG9QbGFudFVNTE9wdGlvbnMgPSB7XG4gICAgICAgICAgICAvLyBpbnB1dEJvZHkgZG9lcyBub3QgbWFrZSBzZW5zZSBmb3IgQ0xJXG4gICAgICAgICAgICAvLyBpbnB1dEJvZHk6IHR5cGVvZiBpbnB1dEZOID09PSAnc3RyaW5nJ1xuICAgICAgICAgICAgLy8gICAgICAgICA/IGF3YWl0IGZzcC5yZWFkRmlsZShpbnB1dEZOLCAndXRmLTgnKVxuICAgICAgICAgICAgLy8gICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGlucHV0Rk5zOiBjbWRPYmouaW5wdXRGaWxlLFxuICAgICAgICAgICAgb3V0cHV0Rk46IGNtZE9iai5vdXRwdXRGaWxlXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGNtZE9iai5jaGFyc2V0KSB7XG4gICAgICAgICAgICBpZiAoIWlzVmFsaWRDaGFyc2V0KGNtZE9iai5jaGFyc2V0KSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgcGxhbnR1bWwgY2hhcnNldCAke3V0aWwuaW5zcGVjdChjbWRPYmouY2hhcnNldCl9IHVua25vd25gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnNldCA9IGNtZE9iai5jaGFyc2V0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNtZE9iai5uYnRocmVhZCkge1xuICAgICAgICAgICAgaWYgKGNtZE9iai5uYnRocmVhZCAhPT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbnQgPSBOdW1iZXIucGFyc2VJbnQoY21kT2JqLm5idGhyZWFkKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4obnQpIHx8IG50IDwgMCB8fCBudCA+IDE2KSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgcGxhbnR1bWwgbmJ0aHJlYWQgJHt1dGlsLmluc3BlY3QoY21kT2JqLm5idGhyZWFkKX0gaW52YWxpZGApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMubmJ0aHJlYWQgPSBjbWRPYmoubmJ0aHJlYWQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJ2Rhcmttb2RlJyBpbiBjbWRPYmopIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY21kT2JqLmRhcmttb2RlICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHBsYW50dW1sIGludmFsaWQgZGFya21vZGUgb3B0aW9uICR7dXRpbC5pbnNwZWN0KGNtZE9iai5kYXJrbW9kZSl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zLmRhcmttb2RlID0gY21kT2JqLmRhcmttb2RlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCdkZWJ1Z3N2ZWsnIGluIGNtZE9iaikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjbWRPYmouZGVidWdzdmVrICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHBsYW50dW1sIGludmFsaWQgZGVidWdzdmVrIG9wdGlvbiAke3V0aWwuaW5zcGVjdChjbWRPYmouZGVidWdzdmVrKX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMuZGVidWdzdmVrID0gY21kT2JqLmRlYnVnc3ZlaztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgnZmlsZW5hbWUnIGluIGNtZE9iaikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjbWRPYmouZmlsZW5hbWUgIT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgcGxhbnR1bWwgaW52YWxpZCBmaWxlbmFtZSBvcHRpb24gJHt1dGlsLmluc3BlY3QoY21kT2JqLmZpbGVuYW1lKX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMuZmlsZU5hbWVPdmVycmlkZSA9IGNtZE9iai5maWxlbmFtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgnbm9tZXRhZGF0YScgaW4gY21kT2JqKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNtZE9iai5ub21ldGFkYXRhICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHBsYW50dW1sIGludmFsaWQgbm9tZXRhZGF0YSBvcHRpb24gJHt1dGlsLmluc3BlY3QoY21kT2JqLm5vbWV0YWRhdGEpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9ucy5ub21ldGFkYXRhID0gY21kT2JqLm5vbWV0YWRhdGE7XG4gICAgICAgIH1cblxuICAgICAgICBvcHRpb25zLm91dHB1dERpciA9IGNtZE9iai5vdXRwdXREaXI7XG5cbiAgICAgICAgaWYgKCd0ZXBzJyBpbiBjbWRPYmopIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY21kT2JqLnRlcHMgIT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgcGxhbnR1bWwgaW52YWxpZCB0ZXBzIG9wdGlvbiAke3V0aWwuaW5zcGVjdChjbWRPYmoudGVwcyl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zLnRlcHMgPSBjbWRPYmoudGVwcztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgndGh0bWwnIGluIGNtZE9iaikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjbWRPYmoudGh0bWwgIT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgcGxhbnR1bWwgaW52YWxpZCB0aHRtbCBvcHRpb24gJHt1dGlsLmluc3BlY3QoY21kT2JqLnRodG1sKX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMudGh0bWwgPSBjbWRPYmoudGh0bWw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJ3RsYXRleCcgaW4gY21kT2JqKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNtZE9iai50bGF0ZXggIT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgcGxhbnR1bWwgaW52YWxpZCB0bGF0ZXggb3B0aW9uICR7dXRpbC5pbnNwZWN0KGNtZE9iai50bGF0ZXgpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9ucy50bGF0ZXggPSBjbWRPYmoudGxhdGV4O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCd0cGRmJyBpbiBjbWRPYmopIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY21kT2JqLnRwZGYgIT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgcGxhbnR1bWwgaW52YWxpZCB0cGRmIG9wdGlvbiAke3V0aWwuaW5zcGVjdChjbWRPYmoudHBkZil9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zLnRwZGYgPSBjbWRPYmoudHBkZjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgndHBuZycgaW4gY21kT2JqKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNtZE9iai50cG5nICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHBsYW50dW1sIGludmFsaWQgdHBuZyBvcHRpb24gJHt1dGlsLmluc3BlY3QoY21kT2JqLnRwbmcpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9ucy50cG5nID0gY21kT2JqLnRwbmc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJ3RzY3htbCcgaW4gY21kT2JqKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNtZE9iai50c2N4bWwgIT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgcGxhbnR1bWwgaW52YWxpZCB0c2N4bWwgb3B0aW9uICR7dXRpbC5pbnNwZWN0KGNtZE9iai50c2N4bWwpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9ucy50c2N4bWwgPSBjbWRPYmoudHNjeG1sO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCd0c3ZnJyBpbiBjbWRPYmopIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY21kT2JqLnRzdmcgIT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgcGxhbnR1bWwgaW52YWxpZCB0c3ZnIG9wdGlvbiAke3V0aWwuaW5zcGVjdChjbWRPYmoudHN2Zyl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zLnRzdmcgPSBjbWRPYmoudHN2ZztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgndHR4dCcgaW4gY21kT2JqKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNtZE9iai50c3ZnICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHBsYW50dW1sIGludmFsaWQgdHR4dCBvcHRpb24gJHt1dGlsLmluc3BlY3QoY21kT2JqLnR0eHQpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9ucy50dHh0ID0gY21kT2JqLnR0eHQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJ3R1dHh0JyBpbiBjbWRPYmopIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY21kT2JqLnR1dHh0ICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHBsYW50dW1sIGludmFsaWQgdHV0eHQgb3B0aW9uICR7dXRpbC5pbnNwZWN0KGNtZE9iai50dXR4dCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zLnR1dHh0ID0gY21kT2JqLnR1dHh0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCd0dmR4JyBpbiBjbWRPYmopIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY21kT2JqLnR2ZHggIT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgcGxhbnR1bWwgaW52YWxpZCB0dmR4IG9wdGlvbiAke3V0aWwuaW5zcGVjdChjbWRPYmoudHZkeCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zLnR2ZHggPSBjbWRPYmoudHZkeDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgndHhtaScgaW4gY21kT2JqKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNtZE9iai50eG1pICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHBsYW50dW1sIGludmFsaWQgdHhtaSBvcHRpb24gJHt1dGlsLmluc3BlY3QoY21kT2JqLnR4bWkpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9ucy50eG1pID0gY21kT2JqLnR4bWk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJ3ZlcmJvc2UnIGluIGNtZE9iaikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjbWRPYmoudmVyYm9zZSAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBwbGFudHVtbCBpbnZhbGlkIHZlcmJvc2Ugb3B0aW9uICR7dXRpbC5pbnNwZWN0KGNtZE9iai52ZXJib3NlKX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMudmVyYm9zZSA9IGNtZE9iai52ZXJib3NlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coe1xuICAgICAgICAgICAgY21kT2JqLCBvcHRpb25zXG4gICAgICAgIH0pXG5cbiAgICAgICAgYXdhaXQgZG9QbGFudFVNTExvY2FsKG9wdGlvbnMpO1xuICAgIH0pO1xuXG5wcm9ncmFtXG4gICAgLmNvbW1hbmQoJ3BpbnRvcmEnKVxuICAgIC5kZXNjcmlwdGlvbignUmVuZGVyIFBpbnRvcmEgZmlsZXMnKVxuICAgIC5vcHRpb24oJy0taW5wdXQtZmlsZSA8aW5wdXRGTj4nLCAnUGF0aCBmb3IgZG9jdW1lbnQgdG8gcmVuZGVyJylcbiAgICAub3B0aW9uKCctLW91dHB1dC1maWxlIDxvdXRwdXRGTj4nLCAnUGF0aCBmb3IgcmVuZGVyZWQgZG9jdW1lbnQnKVxuICAgIC5vcHRpb24oJy0tcGl4ZWwtcmF0aW8gPHJhdGlvPicsICcnKVxuICAgIC5vcHRpb24oJy0tbWltZS10eXBlIDxtdD4nLCAnTUlNRSB0eXBlIGZvciBvdXRwdXQgZmlsZScpXG4gICAgLm9wdGlvbignLS1iZy1jb2xvciA8Y29sb3I+JywgJ1N0cmluZyBkZXNjcmliaW5nIGJhY2tncm91bmQgY29sb3InKVxuICAgIC5vcHRpb24oJy0td2lkdGggPG51bWJlcj4nLCAnV2lkdGggb2YgdGhlIG91dHB1dCwgaGVpZ2h0IHdpbGwgYmUgY2FsY3VsYXRlZCBhY2NvcmRpbmcgdG8gdGhlIGRpYWdyYW0gY29udGVudCByYXRpbycpXG4gICAgLmFjdGlvbihhc3luYyAoY21kT2JqKSA9PiB7XG4gICAgICAgIGNvbnN0IG9wdHM6IFBpbnRvcmFSZW5kZXJPcHRpb25zID0ge1xuICAgICAgICAgICAgY29kZTogJycsXG4gICAgICAgICAgICBvdXRwdXRGTjogJydcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAodHlwZW9mIGNtZE9iai5pbnB1dEZpbGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBvcHRzLmNvZGUgPSBhd2FpdCBmc3AucmVhZEZpbGUoY21kT2JqLmlucHV0RmlsZSwgJ3V0Zi04Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGlucHV0IGZpbGUgc3BlY2lmaWVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGNtZE9iai5vdXRwdXRGaWxlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgb3B0cy5vdXRwdXRGTiA9IGNtZE9iai5vdXRwdXRGaWxlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBvdXRwdXQgZmlsZSBzcGVjaWZpZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgY21kT2JqLnBpeGVsUmF0aW8gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBvcHRzLmRldmljZVBpeGVsUmF0aW8gPSBOdW1iZXIucGFyc2VGbG9hdChjbWRPYmoucGl4ZWxSYXRpbyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvcHRzLmRldmljZVBpeGVsUmF0aW8gIT09ICd1bmRlZmluZWQnXG4gICAgICAgICAmJiBpc05hTihvcHRzLmRldmljZVBpeGVsUmF0aW8pKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZGV2aWNlIHBpeGVsIHJhdGlvICR7dXRpbC5pbnNwZWN0KGNtZE9iai5waXhlbFJhdGlvKX1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgY21kT2JqLm1pbWVUeXBlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGNtZE9iai5taW1lVHlwZSA9PT0gJ2ltYWdlL3N2Zyt4bWwnXG4gICAgICAgICAgICAgfHwgY21kT2JqLm1pbWVUeXBlID09PSAnaW1hZ2UvanBlZydcbiAgICAgICAgICAgICB8fCBjbWRPYmoubWltZVR5cGUgPT09ICdpbWFnZS9wbmcnXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBvcHRzLm1pbWVUeXBlID0gY21kT2JqLm1pbWVUeXBlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgTUlNRSB0eXBlICR7dXRpbC5pbnNwZWN0KGNtZE9iai5taW1lVHlwZSl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGNtZE9iai5iZ0NvbG9yID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgb3B0cy5iYWNrZ3JvdW5kQ29sb3IgPSBjbWRPYmouYmdDb2xvcjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgY21kT2JqLndpZHRoID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgb3B0cy53aWR0aCA9IE51bWJlci5wYXJzZUZsb2F0KGNtZE9iai53aWR0aCk7XG4gICAgICAgICAgICBpZiAoaXNOYU4ob3B0cy53aWR0aCkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGRpYWdyYW1zLXBpbnRvcmE6IHdpZHRoIGlzIG5vdCBhIG51bWJlciAke2NtZE9iai53aWR0aH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIG9wdHMucmVuZGVySW5TdWJwcm9jZXNzID0gZmFsc2U7XG5cbiAgICAgICAgYXdhaXQgZG9QaW50b3JhKG9wdHMpO1xuICAgIH0pO1xuXG5cbnByb2dyYW0ucGFyc2UoKTtcbiJdfQ==